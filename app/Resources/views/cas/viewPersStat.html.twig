{% extends 'base.html.twig' %}


{% block title %}C.A.S - Statistiques Personnelles{% endblock %}

{% block body %}

    <!-- Modal for ajax loading -->
    <div id="modal_loading" class="modal ajax_modals">
        <div class="modal-content">
            <p class="center">
                <img src="{{ asset('img/ajax_loaders/ajax-loading.gif') }}">
            </p>
        </div>
    </div>

<div class="container-fluid">
    <div class="wrapper">

        {% include('cas/partials/_sidebar.html.twig') %}

        <!-- Modal for ajax loading -->
        <div id="modal_loading" class="modal ajax_modals">
            <div class="modal-content">
                <p class="center">
                    <img src="{{ asset('img/ajax_loaders/ajax-loading.gif') }}">
                </p>
            </div>
        </div>

        <div class="content-page">
            <div class="content">

                <div class="col-lg-12">
                    <h2 class="page-title"><span class="uil-chart-bar"></span> Statistiques</h2>
                </div>

                <div class="row card">
        <div class="col-lg-12 card-body">
            <p class="description_message">Affichez les statistiques individuelles d'un employé précis.Vous verrez les pertes en temps et en argent occasionnées par ses absences ou ses retards</p>

            <!-- <div id="modal1" class="modal modal-loading" style="overflow: hidden">
                <div class="modal-content" style="overflow: hidden">
                    <p class="center" style="margin-top: 150px"><img src="{{ asset("img/ajax_loaders/ajax-loading.gif") }}" style="height: 50px"> </p>
                </div>
            </div> -->

            <div class="row">
                <div class="col-lg-12">
                    <ul class="collapsible" data-collapsible="accordion">
                        <li>
                            <div class="collapsible-header collapsible-header-title active">Choisissez les paramètres</div>
                            <div class="collapsible-body" style="padding-bottom: 0px">
                                <div class="row">
                                    <form method="post" action="{{ path('generatePDF') }}" target="_blank" id="form" class="col-lg-12">
                                        <div class="row row-no-margin">
                                            <div class="input-field col s12">
                                                <div class="row" id="errorContainer">
                                                    <div class="col-lg-12">
                                                        <span class="red-text"></span>
                                                    </div>
                                                </div>
                                                <div class="row row-no-margin">
                                                    <div class="col-lg-6">
                                                        <span>Veuillez sélectionner le département de votre choix</span>
                                                        <br>
                                                        <select id="depSelect" class="form-control input-customized browser-default">
                                                            <option value="" selected>Département</option>
                                                            {% for dep in listDep %}
                                                                <option value="{{ dep.id }}">{{ dep.name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <span>Veuillez sélectionner l'employé</span>
                                                        <br>
                                                        <select name="destination[]" id="empSelect" class="form-control input-customized browser-default">
                                                            <option value='' selected>Employé</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <br>
                                                <span>Veuillez sélectionner la durée de votre choix</span>

                                                <div class="row row-no-margin">
                                                    <div class="col-lg-6">
                                                        <h4>Du</h4>
                                                        <input id="fromDate" name="fromDate" type="date" class="form-control datepicker input-customized" placeholder="DU">
                                                    </div>

                                                    <div class="col-lg-6">
                                                        <h4>Au</h4>
                                                        <input id="toDate" name="toDate" type="date" class="form-control datepicker input-customized" placeholder="AU">
                                                    </div>
                                                </div>
                                                <div class="row" style="width: 100%">
                                                    <div class="col-lg-6">
                                                    </div>
                                                    <div class="col-lg-6 ">
                                                        <input type="button" id="submitButton" value="Valider" class="float-right mt-2 btn-lg btn btn-success btn-perso-historique">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div id="containerMustBeHidden" style="display: none">
            <h5 class="table-title">Statistiques de l'employé</h5>
                <div class="row">
                    <div class="col-lg-12">
                        <table class="card table bordered striped condensed centered">
                            <tr class="blue lighten-2 white-text">
                                <td colspan="2">Nom : <span id="nameSpan"></span></td>
                                <td>Fonction : <span id="fonctionSpan"></span></td>
                                <td colspan="2">Salaire : <span id="salarySpan"></span></td>
                            </tr>
                            <tr class="">
                                <th class="center">Date :</th>
                                <th class="center">Jours à travailler :</th>
                                <th class="center">Nombre de permission :</th>
                                <th colspan="2" class="center">Salaire équivalant : <span id="salarySpan"></span></th>
                            </tr>
                            <tr>
                                <td>
                                    <span id="fromDateSpan"></span>
                                    <br>
                                    au
                                    <br>
                                    <span id="toDateSpan"></span>
                                </td>
                                <td>
                                    <span id="jourTravailleSpan">-</span>
                                </td>
                                <td>
                                    <span id="nbrePermissionSpan">-</span>
                                </td>
                                <td colspan="2">
                                    =
                                    <br>
                                    <span id="totalSalarySpan"></span>
                                </td>
                            </tr>
                            <tr>
                                <th class="center">Absences</th>
                                <th class="center">Retards</th>
                                <th class="center">Départs prématurés</th>
                                <th class="center" colspan="2">Authentifications incomplètes</th>
                            </tr>
                            <tr>
                                <td><span id="absenceSpan"></span></td>
                                <td><span id="retardSpan"></span></td>
                                <td><span id="departSpan"></span></td>
                                <td colspan="2"><span id="nbreAuthInc"></span></td>
                            </tr>
                            <tr>
                                <th colspan="5" class="center">Total Temps Perdu (En Heures)</th>
                            </tr>
                            <tr>
                                <td><span id="tpaSpan">-</span></td>
                                <td><span id="tprSpan"></span></td>
                                <td><span id="tpdSpan"></span></td>
                                <td colspan="2"><span id="tpAuthSpan">-</span></td>
                            </tr>
                            <tr>
                                <th colspan="5" class="center">Total d'argent Perdu</th>
                            </tr>
                            <tr>
                                <td><span id="spaSpan"></span> FCFA</td>
                                <td><span id="sprSpan"></span> FCFA</td>
                                <td><span id="spdSpan"></span> FCFA</td>
                                <td colspan="2"><span id="spAuthSpan">-</span></td>
                            </tr>
                            <tr class="red lighten-2 white-text">
                                <td colspan="2">Total temps perdu : <span id="ttpSpan"></span> H</td>
                                <td colspan="3">Total d'argent perdu : <span id="tapSpan"></span> FCFA (<span id="papSpan"></span>%)</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <h5 class="table-title">Historique des présences</h5>
                        <br><br>
                        <table class="bordered striped">
                            <thead>
                            <tr>
                                <th>Date</th>
                                <th>Arrivée</th>
                                <th>Pause</th>
                                <th>Fin pause</th>
                                <th>Départ</th>
                                <!-- <th>Quota</th> -->
                            </tr>
                            </thead>

                            <tbody id="rowsContainer">
                            <tr>
                                <td colspan="9">
                                    <h5 class="center">Aucun résultat</h5>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <br>
                        <span class="uil-circle" style="color: red"></span>
                        <span style="color: red">Retards ou départs prématurés</span>
                        <br>
                        <span class="uil-circle" style="color: black"></span>
                        <span style="color: black">Heures conformes</span>
                    </div>
                </div>

                <div class="row">
                    <h5 class="table-title">Permissions</h5>
                    <table class="center">
                        <thead>
                            <tr>
                                <th>Date de la permission</th>
                                <th>Type</th>
                                <th>Temps à rajouter</th>
                                <th>Somme à rajouter</th>
                            </tr>
                        </thead>
                        <tbody id="tabPermissions">
                            <tr>
                                <td colspan="4" style="text-align: center">Aucune permission</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row delaysPieChart">
                    <div class="col-lg-6">
                        <span>Diagramme cumulé des absences</span>
                        <div class="myPieChartContainer">
                            <canvas id="myPieChart" class="card" style="cursor: pointer">
                            </canvas>
                        </div>
                    </div>
                    <div class="col-lg-6 departuresChart">
                        <span>Diagramme des absences</span>
                        <div class="myChartContainer">
                            <h5 style="padding:20px" class="data_placeholder">Aucune absence enregistrée</h5>
                            <canvas id="myChart" class="card">
                            </canvas>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <span>Retards début de journée</span>
                        <table class="card table bordered centered striped highlight responsive-table">
                            <thead>
                            <tr>
                                <th>Date</th>
                                <th>Heure d'arrivée</th>
                                <th>Lapse</th>
                            </tr>
                            </thead>
                            <tbody id="tabRetards14">
                            <tr>
                                <td colspan="3">Aucune donnée à afficher</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-lg-6">
                        <span>Départs prématurés de fin d'après-midi</span>
                        <table class="card table bordered centered striped highlight responsive-table">
                            <thead>
                            <tr>
                                <th>Date</th>
                                <th>Heure de départ</th>
                                <th>Lapse</th>
                            </tr>
                            </thead>
                            <tbody id="tabDepartsPrematures17">
                            <tr>
                                <td colspan="3">Aucune donnée à afficher</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <span>Départs prématurés de midi</span>
                        <table class="card table bordered centered striped highlight responsive-table">
                            <thead>
                            <tr>
                                <th>Date</th>
                                <th>Heure de départ</th>
                                <th>Lapse</th>
                            </tr>
                            </thead>
                            <tbody id="tabDepartsPrematures12">
                            <tr>
                                <td colspan="3">Aucune donnée à afficher</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-lg-6">
                        <span>Retards début d'après-midi</span>
                        <table class="card table bordered centered striped highlight responsive-table">
                            <thead>
                            <tr>
                                <th>Date</th>
                                <th>Heure d'arrivée</th>
                                <th>Lapse</th>
                            </tr>
                            </thead>
                            <tbody id="tabRetards8">
                            <tr>
                                <td colspan="3">Aucune donnée à afficher</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <h5 class="table-title">Diagrammes</h5>

                <span class="CContainer lundiCContainer">
                    <p class="legend">Lundi</p>
                    <div class="row chartsContainer">
                        <div class="col-lg-6 lundiDiagDep12">
                            <span>Diagramme des départs prématurés de 12H00</span>
                            <canvas id="lundi-m-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 lundiDiagDep18">
                            <span>Diagramme des départs prématurés de 18H00</span>
                            <canvas id="lundi-n-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 lundiDiagRet8">
                            <span>Diagramme des retards de 8H00</span>
                            <canvas id="lundi-m8-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 lundiDiagRet14">
                            <span>Diagramme des retards de 14H00</span>
                            <canvas id="lundi-n14-chart" class="card"></canvas>
                        </div>
                    </div>
                </span>
                <span class="CContainer mardiCContainer">
                    <p class="legend">Mardi</p>
                    <div class="row chartsContainer" id="chartsContainer">
                        <div class="col-lg-6 mardiDiagDep12">
                            <span>Diagramme des départs prématurés de 12H00</span>
                            <canvas id="mardi-m-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 mardiDiagDep18">
                            <span>Diagramme des départs prématurés de 18H00</span>
                            <canvas id="mardi-n-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 mardiDiagRet8">
                            <span>Diagramme des retards de 8H00</span>
                            <canvas id="mardi-m8-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 mardiDiagRet14">
                            <span>Diagramme des retards de 14H00</span>
                            <canvas id="mardi-n14-chart" class="card"></canvas>
                        </div>
                    </div>
                </span>
                <span class="CContainer mercrediCContainer">
                    <p class="legend">Mercredi</p>
                    <div class="row chartsContainer" id="chartsContainer">
                        <div class="col-lg-6 mercrediDiagDep12">
                            <span>Diagramme des départs prématurés de 12H00</span>
                            <canvas id="mercredi-m-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 mercrediDiagDep18">
                            <span>Diagramme des départs prématurés de 18H00</span>
                            <canvas id="mercredi-n-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 mercrediDiagRet8">
                            <span>Diagramme des retards de 8H00</span>
                            <canvas id="mercredi-m8-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 mercrediDiagRet14">
                            <span>Diagramme des retards de 14H00</span>
                            <canvas id="mercredi-n14-chart" class="card"></canvas>
                        </div>
                    </div>
                </span>
                <span class="CContainer jeudiCContainer">
                    <p class="legend">Jeudi</p>
                    <div class="row chartsContainer" id="chartsContainer">
                        <div class="col-lg-6 jeudiDiagDep12">
                            <span>Diagramme des départs prématurés de 12H00</span>
                            <canvas id="jeudi-m-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 jeudiDiagDep18">
                            <span>Diagramme des départs prématurés de 18H00</span>
                            <canvas id="jeudi-n-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 jeudiDiagRet8">
                            <span>Diagramme des retards de 8H00</span>
                            <canvas id="jeudi-m8-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 jeudiDiagRet14">
                            <span>Diagramme des retards de 14H00</span>
                            <canvas id="jeudi-n14-chart" class="card"></canvas>
                        </div>
                    </div>
                </span>
                <span class="CContainer vendrediCContainer">
                    <p class="legend">Vendredi</p>
                    <div class="row chartsContainer" id="chartsContainer">
                        <div class="col-lg-6 vendrediDiagDep12">
                            <span>Diagramme des départs prématurés de 12H00</span>
                            <canvas id="vendredi-m-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 vendrediDiagDep18">
                            <span>Diagramme des départs prématurés de 18H00</span>
                            <canvas id="vendredi-n-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 vendrediDiagRet8">
                            <span>Diagramme des retards de 8H00</span>
                            <canvas id="vendredi-m8-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 vendrediDiagRet14">
                            <span>Diagramme des retards de 14H00</span>
                            <canvas id="vendredi-n14-chart" class="card"></canvas>
                        </div>
                    </div>
                </span>
                <span class="CContainer samediCContainer">
                    <p class="legend">Samedi</p>
                    <div class="row chartsContainer" id="chartsContainer">
                        <div class="col-lg-6 samediDiagDep12">
                            <span>Diagramme des départs prématurés de 12H00</span>
                            <canvas id="samedi-m-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 samediDiagDep18">
                            <span>Diagramme des départs prématurés de 18H00</span>
                            <canvas id="samedi-n-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 samediDiagRet8">
                            <span>Diagramme des retards de 8H00</span>
                            <canvas id="samedi-m8-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 samediDiagRet14">
                            <span>Diagramme des retards de 14H00</span>
                            <canvas id="samedi-n14-chart" class="card"></canvas>
                        </div>
                    </div>
                </span>
                <span class="CContainer dimancheCContainer">
                    <p class="legend">Dimanche</p>
                    <div class="row chartsContainer" id="chartsContainer">
                        <div class="col-lg-6 dimancheDiagDep12">
                            <span>Diagramme des départs prématurés de 12H00</span>
                            <canvas id="dimanche-m-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 dimancheDiagDep18">
                            <span>Diagramme des départs prématurés de 18H00</span>
                            <canvas id="dimanche-n-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 dimancheDiagRet8">
                            <span>Diagramme des retards de 8H00</span>
                            <canvas id="dimanche-m8-chart" class="card"></canvas>
                        </div>
                        <div class="col-lg-6 dimancheDiagRet14">
                            <span>Diagramme des retards de 14H00</span>
                            <canvas id="dimanche-n14-chart" class="card"></canvas>
                        </div>
                    </div>
                </span>
                <div class="row quotaPieDiagram">
                    <div class="col-lg-12">
                        <span>Diagramme comparatif des quotas horraires</span>
                        <canvas id="quotaPieChart" class="card" style="cursor: pointer">
                        </canvas>
                    </div>
                </div>
                <div class="fixed-action-btn" style="margin-bottom: 30px">
                    <a class="btn-floating tooltipped pulse green btn-large" id="btnPrint" data-position="top" data-tooltip="Imprimer">
                        <span class="uil-print"></span>
                    </a>
                </div>
            </div>
        </div>
    </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset("js/Chart.min.js") }}"></script>
    <script>
        $(function () {
            $("#btnPrint").click(function () {
                $("#form").submit();
            });
        });
    </script>
    <script>

        function precisionRound(number, precision) {
            var factor = Math.pow(10, precision);
            return Math.round(number * factor) / factor;
        }

        var tempsPerduRetards = 0;
        $(function(){
            //alert("appel de la fonction");
            $('#modal1').modal({
                dismissible: false, // Modal can be dismissed by clicking outside of the modal
            });
            $('#modal1').modal('open');
            /* Création de la fonction qui permet de renvoyer le jour */

            function returnJour(date) {
                var days = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
                var theDate = new Date(date);
                var dayName = days[theDate.getDay()];

                return dayName;

            }

            /* Création de la fonction de chargement des données de l'employé sélectionné */
            function loadSelectedEmpData(id) {
                function hoursDiff(begin_hour,end_hour){
                    var splited_first_hour = begin_hour.split(":");
                    var splited_second_hour = end_hour.split(":");
                    var first_hour = Number(splited_first_hour[0])+(Number(splited_first_hour[1])/60);
                    var second_hour = Number(splited_second_hour[0])+(Number(splited_second_hour[1])/60);
                    return second_hour-first_hour;
                }
                var abs = 0;
                // Formatting the date into yyyy-mm-dd format
                var fromDate = $("#fromDate").val().split("-").reverse().join("-");
                var fFromDate = new Date(fromDate);
                // Formatting the date into yyyy-mm-dd format
                var toDate = $("#toDate").val().split("-").reverse().join("-");
                console.log("fromdat --- : "+toDate);
                var fToDate = new Date(toDate);

                // fonction d'ajout de date
                Date.prototype.addDays = function(days) {
                    var dat = new Date(this.valueOf());
                    dat.setDate(dat.getDate() + days);
                    return dat;
                }
                $.ajax({
                    type: 'POST',
                    url: "returnOneEmployee/"+id,
                    data: {'dateFrom':fromDate,'dateTo':toDate},
                    success: function(data) {
                        var res = JSON.parse(data);
                        console.log("debug");
                        console.log(res);
                        console.log("end debug");
                        //alert("Le résultat : "+res.emp["id"]);
                        var employeeId = res.emp["id"];
                        var fullName = res.emp["surname"]+" "+res.emp["lastName"];
                        var salary = res.emp["salary"];
                        var fonction = res.emp["function"];

                        var timeDiff = Math.abs(fToDate.getTime() - fFromDate.getTime());
                        var diffDays = timeDiff / (1000 * 3600 * 24);
                        diffDays +=1;
                        var totalSalary = (salary/30)*diffDays;
                        var salaryPerDay = (salary/30);
                        var salaryPerHour = res.emp["workingHour"]["taux"];
                        var jour_travail = Number(res.emp["workingHour"]["jourTravail"]);
                        var salaryPerMin = (((salary/30)/24)/60);

                        tempsPerduRetards = data.tpr;

                        $("#nameSpan").text(fullName);
                        $("#salarySpan").text(salary);
                        $("#fonctionSpan").text(fonction);
                        $("#fromDateSpan").text(fromDate);
                        $("#toDateSpan").text(toDate);
                        console.log("Salary : "+salary);
                        console.log("Total salary : "+totalSalary);
                        console.log("Diff days : "+diffDays);

                        // Recuperation des autres informations
                        $.ajax({
                            type: 'POST',
                            url: "userStats",
                            data: {'empId':employeeId,'dateFrom':fromDate,'dateTo':toDate},
                            success: function (data) {
                                // We need to empty some fields
                                $("#tempsPerduQuotaSpan").text("-");

                                console.log(data);
                                var type = JSON.parse(res.emp["workingHour"]["workingHour"])["lundi"][0]["type"];
                                //
                                var ss = 0;
                                if(type == "3" || type == 3){
                                    ss = ((Number(salary)*12)/52)/(Number(jour_travail))*(Number(data["nbreJourTravail"]));
                                }else if(type == "2" || type == 2){
                                    console.log(res.emp["workingHour"]["taux"]);
                                    ss = (((Number(salary)*12)/52)/Number(res.emp["workingHour"]["taux"]))*Number(data["quota_total"]/60);
                                    console.log(ss);
                                }else if(type == "1" || type == 1 || type == "4" || type == 4){
                                    ss = (((Number(salary)*12)/52)/Number(res.emp["workingHour"]["taux"]))*Number(data["quota_1_4"]);
                                }else{
                                    ss += 0;
                                }
                                $("#containerMustBeHidden").attr("style","display:block");
                                $("#totalSalarySpan").text(precisionRound(ss,2));
                                $("#jourTravailleSpan").text(data.nbreJourTravail - data.jourFeries);
                                $("#nbrePermissionSpan").text(data.nbrePermission);
                                $("#absenceSpan").text(data.absences);
                                $("#retardSpan").text(data.retards);
                                $("#departSpan").text(data.departs);
                                // On fait d'abord un test
                                if(data.quota_fait > data.quota_total){
                                    $("#quotaTotalSpan").text(precisionRound(data.quota_total/60,1)+"/"+data.quota_total/60);
                                }else if(data.quota_fait < data.quota_total){
                                    var quotaDiff = (data.quota_total - data.quota_fait);
                                    $("#tempsPerduQuotaSpan").text(quotaDiff);
                                    $("#sommePerduQuotaSpan").text(precisionRound(data.sommePerduQuota,0));
                                }
                                $("#quotaTotalSpan").text(precisionRound(data.quota_fait/60,1)+"/"+data.quota_total/60);
                                var stp = 0;
                                var ttp = 0;
                                if(type == 2 || type == "2"){
                                    $("#nbreAuthInc").text(data.inc_auth);
                                    $("#tpaSpan").text(precisionRound(data.tpa,2)+" H");
                                    $("#tprSpan").text(precisionRound(data.tpr,2)+" H");
                                    $("#tpdSpan").text(precisionRound(data.tpd,2));
                                    $("#sprSpan").text(precisionRound(data.spr,2));
                                    $("#spdSpan").text(precisionRound(data.spd,2));
                                    $("#spaSpan").text(precisionRound(data.spa,2));
                                    stp = data.spa+data.spr+data.spd+data.spAuth;
                                    ttp = data.tpa+data.tpr+data.tpd+data.lost_time;
                                }else if(type == 3 || type == "3"){
                                    $("#nbreAuthInc").text(data.inc_auth);
                                    $("#tpaSpan").text("-");
                                    $("#tprSpan").text(precisionRound(data.tpr,2)+" H");
                                    $("#tpdSpan").text(precisionRound(data.tpd,2)+" H");
                                    $("#sprSpan").text(precisionRound(data.spr,2));
                                    $("#spdSpan").text(precisionRound(data.spd,2));
                                    $("#spaSpan").text(precisionRound(data.spa,2));
                                    stp = data.spa+data.spr+data.spd+data.spAuth;
                                    ttp = data.tpa+data.tpr+data.tpd+data.lost_time;
                                }else{
                                    $("#nbreAuthInc").text(data.inc_auth);
                                    $("#tpaSpan").text(precisionRound(data.tpa,2)+" H");
                                    $("#tprSpan").text(precisionRound(data.tpr,2)+" H");
                                    $("#tpdSpan").text(precisionRound(data.tpd,2)+" H");
                                    $("#sprSpan").text(precisionRound(data.spr,2));
                                    $("#spdSpan").text(precisionRound(data.spd,2));
                                    $("#spaSpan").text(precisionRound(data.spa,2));
                                    stp = data.spa+data.spr+data.spd+data.spAuth;
                                    ttp = data.tpa+data.tpr+data.tpd+data.lost_time;
                                }
                                $("#nbreAuthInc").text(data.inc_auth);
                                $("#tpAuthSpan").text(precisionRound(data.lost_time,2)+" H");
                                $("#spAuthSpan").text(precisionRound(data.spAuth,2));
                                $("#spaSpan").text(precisionRound(data.spa,2));
                                $("#tapSpan").text(precisionRound(stp,2));
                                $("#ttpSpan").text(precisionRound(ttp,2));
                                $("#papSpan").text(precisionRound(((stp/ss)*100),2));
                                //var res = JSON.parse(data.test);
                                var i=0;
                                $("#rowsContainer").html("");
                                    $.each(data.historique,function (arrayID) {
                                    i++;
                                    if((data.historique[arrayID]["arrive"] != "" && data.historique[arrayID]["arrive"] != null) || (data.historique[arrayID]["depart"] != "" && data.historique[arrayID]["depart"] != null) || (data.historique[arrayID]["pause"] != "" && data.historique[arrayID]["pause"] != null) || (data.historique[arrayID]["finPause"] != "" && data.historique[arrayID]["finPause"] != null)){
                                        switch (data.historique[arrayID]["type"]){
                                            case "1":
                                                $("#rowsContainer").append("" +
                                                    "<tr>" +
                                                    "<td><span class='redSpan_1_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["date"] +"</span></td>" +
                                                    "<td><span class='redSpan_1_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["arrive"] +"</span> <span style='margin-left: 4px;font-size: 12px'>"+data.historique[arrayID]["bH"]+"</span></td>" +
                                                    "<td><span class='redSpanPauseBegin_1_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["pause"] +"</span> <span style='margin-left: 4px;font-size: 12px'>"+data.historique[arrayID]["pBH"]+"</span></td>" +
                                                    "<td><span class='redSpanPauseEnd_1_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["finPause"] +"</span> <span style='margin-left: 4px;font-size: 12px'>"+data.historique[arrayID]["pEH"]+"</span></td>" +
                                                    "<td><span class='redSpanEnd_1_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["depart"] +"</span> <span style='margin-left: 4px;font-size: 12px'>"+data.historique[arrayID]["eH"]+"</span></td>" +
                                                    "</tr>"
                                                );
                                                if(data.historique[arrayID]["arrive"] > data.historique[arrayID]["bH"]){
                                                    $(".redSpan_1_"+i).css("color","red");
                                                }if(data.historique[arrayID]["pause"] < data.historique[arrayID]["pBH"]){
                                                    $(".redSpanPauseBegin_1_"+i).css("color","red");
                                                }if(data.historique[arrayID]["finPause"] > data.historique[arrayID]["pEH"]){
                                                    $(".redSpanPauseEnd_1_"+i).css("color","red");
                                                }if(data.historique[arrayID]["depart"] < data.historique[arrayID]["eH"]){
                                                    $(".redSpanEnd_1_"+i).css("color","red");
                                                }
                                                break;
                                            case "2":
                                                $("#rowsContainer").append("" +
                                                    "<tr>" +
                                                    "<td><span style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["date"] +"</span></td>" +
                                                    "<td><span class='redSpan_2_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["arrive"] +"</span> <span style='margin-left: 4px;font-size: 12px'>"+data.historique[arrayID]["bH"]+"</span></td>" +
                                                    "<td><span class='redSpanPauseBegin_2_"+i+"' style='font-size: 17px;font-weight: 500'> - </span></td>" +
                                                    "<td><span class='redSpanPauseEnd_2_"+i+"' style='font-size: 17px;font-weight: 500'> - </span></td>" +
                                                    "<td><span class='redSpanEnd_2_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["depart"] +"</span> <span style='margin-left: 4px;font-size: 12px'>"+data.historique[arrayID]["eH"]+"</span></td>" +
                                                    "</tr>"
                                                );
                                                if(data.historique[arrayID]["arrive"] > data.historique[arrayID]["bH"]){
                                                    $(".redSpan_2_"+i).css("color","red");
                                                }if(data.historique[arrayID]["pause"] < data.historique[arrayID]["pBH"]){
                                                    $(".redSpanPauseBegin_2_"+i).css("color","red");
                                                }if(data.historique[arrayID]["finPause"] > data.historique[arrayID]["pEH"]){
                                                    $(".redSpanPauseEnd_2_"+i).css("color","red");
                                                }if(data.historique[arrayID]["depart"] < data.historique[arrayID]["eH"]){
                                                    $(".redSpanEnd_2_"+i).css("color","red");
                                                }
                                                break;
                                            case "3":
                                                $("#rowsContainer").append("" +
                                                    "<tr>" +
                                                    "<td colspan='6' class='green lighten-2 white-text center'> Présent </td>" +
                                                    "</tr>"
                                                );
                                                break;
                                            case "4":
                                                $("#rowsContainer").append("" +
                                                    "<tr>" +
                                                    "<td><span class='redSpan_3_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["date"] +"</span></td>" +
                                                    "<td><span class='redSpan_3_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["arrive"] +"</span> <span style='margin-left: 4px;font-size: 12px'>"+data.historique[arrayID]["bH"]+"</span></td>" +
                                                    "<td><span class='redSpanPauseBegin_3_"+i+"' style='font-size: 17px;font-weight: 500'> - </span></td>" +
                                                    "<td><span class='redSpanPauseEnd_3_"+i+"' style='font-size: 17px;font-weight: 500'> - </span></td>" +
                                                    "<td><span class='redSpanEnd_3_"+i+"' style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["depart"] +"</span> <span style='margin-left: 4px;font-size: 12px'>"+data.historique[arrayID]["eH"]+"</span></td>" +
                                                    "</tr>"
                                                );
                                                if(data.historique[arrayID]["arrive"] > data.historique[arrayID]["bH"]){
                                                    $(".redSpan_3_"+i).css("color","red");
                                                }if(data.historique[arrayID]["pause"] < data.historique[arrayID]["pBH"]){
                                                    $(".redSpanPauseBegin_3_"+i).css("color","red");
                                                }if(data.historique[arrayID]["finPause"] > data.historique[arrayID]["pEH"]){
                                                    $(".redSpanPauseEnd_3_"+i).css("color","red");
                                                }if(data.historique[arrayID]["depart"] < data.historique[arrayID]["eH"]){
                                                    $(".redSpanEnd_3_"+i).css("color","red");
                                                }
                                                break;
                                            case "null":
                                                $("#rowsContainer").append("" +
                                                    "<tr>" +
                                                    "<td><span style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["date"] +"</span></td>" +
                                                    "<td colspan='4' class='center gray lighten-3 white-text'><span style='font-weight:bold;color:green'> Présence non requise </span></td>" +
                                                    "</tr>"
                                                );
                                                break;
                                        }
                                    }else if(data.historique[arrayID]["type"] == "null" || data.historique[arrayID]["type"] == null){
                                        $("#rowsContainer").append("" +
                                            "<tr>" +
                                            "<td><span style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["date"] +"</span></td>" +
                                            "<td colspan='4' class='center gray lighten-3 white-text'><span style='font-weight:bold;color:green'> Présence non requise </span></td>" +
                                            "</tr>"
                                        );
                                    }else{
                                        $("#rowsContainer").append("" +
                                            "<tr>" +
                                            "<td><span style='font-size: 17px;font-weight: 500'>" + data.historique[arrayID]["date"] +"</span></td>" +
                                            "<td colspan='4' class='center gray lighten-3 white-text'><span style='font-weight:bold;color:red'> Absence</span></td>" +
                                            "</tr>"
                                        );
                                    }
                                });

                                // Boucle pour remplir les tableau

                                var pauseDatas = [];
                                var retardDatas = [];
                                var retardPauseDatas = [];
                                var finDatas = [];

                                var pauseLabels = [];
                                var retardLabels = [];
                                var retardPauseLabels = [];
                                var finLabels = [];

                                // Variables des jours

                                var lundiPauseTabDatas = [];
                                var lundiRetardTabDatas = [];
                                var lundiRetardPauseTabDatas = [];
                                var lundiFinTabDatas = [];

                                var mardiPauseTabDatas = [];
                                var mardiRetardTabDatas = [];
                                var mardiRetardPauseTabDatas = [];
                                var mardiFinTabDatas = [];

                                var mercrediPauseTabDatas = [];
                                var mercrediRetardTabDatas = [];
                                var mercrediRetardPauseTabDatas = [];
                                var mercrediFinTabDatas = [];

                                var jeudiPauseTabDatas = [];
                                var jeudiRetardTabDatas = [];
                                var jeudiRetardPauseTabDatas = [];
                                var jeudiFinTabDatas = [];

                                var vendrediPauseTabDatas = [];
                                var vendrediRetardTabDatas = [];
                                var vendrediRetardPauseTabDatas = [];
                                var vendrediFinTabDatas = [];

                                var samediPauseTabDatas = [];
                                var samediRetardTabDatas = [];
                                var samediRetardPauseTabDatas = [];
                                var samediFinTabDatas = [];

                                var dimanchePauseTabDatas = [];
                                var dimancheRetardTabDatas = [];
                                var dimancheRetardPauseTabDatas = [];
                                var dimancheFinTabDatas = [];

                                // Pour les labels

                                var lundiPauseTabLabels = [];
                                var lundiRetardTabLabels = [];
                                var lundiRetardPauseTabLabels = [];
                                var lundiFinTabLabels = [];

                                var mardiPauseTabLabels = [];
                                var mardiRetardTabLabels = [];
                                var mardiRetardPauseTabLabels = [];
                                var mardiFinTabLabels = [];

                                var mercrediPauseTabLabels = [];
                                var mercrediRetardTabLabels = [];
                                var mercrediRetardPauseTabLabels = [];
                                var mercrediFinTabLabels = [];

                                var jeudiPauseTabLabels = [];
                                var jeudiRetardTabLabels = [];
                                var jeudiRetardPauseTabLabels = [];
                                var jeudiFinTabLabels = [];

                                var vendrediPauseTabLabels = [];
                                var vendrediRetardTabLabels = [];
                                var vendrediRetardPauseTabLabels = [];
                                var vendrediFinTabLabels = [];

                                var samediPauseTabLabels = [];
                                var samediRetardTabLabels = [];
                                var samediRetardPauseTabLabels = [];
                                var samediFinTabLabels = [];

                                var dimanchePauseTabLabels = [];
                                var dimancheRetardTabLabels = [];
                                var dimancheRetardPauseTabLabels = [];
                                var dimancheFinTabLabels = [];

                                // Before any action else we must delete the content
                                $("#tabDepartsPrematures12").html("");
                                if(data.pauseStats.length > 0){
                                    for(var j=0;j < data.pauseStats.length;j++){

                                        var laDate = data.pauseStats[j].date;
                                        var tabDate = laDate.split("/");
                                        var dateReformate = tabDate[2]+"/"+tabDate[1]+"/"+tabDate[0];
                                        var dateObject = new Date(dateReformate);
                                        var leJour = dateObject.getDay();
                                        switch (leJour){
                                            case 1:
                                                lundiPauseTabDatas.push(precisionRound(data.pauseStats[j].temps,2));
                                                lundiPauseTabLabels.push(data.pauseStats[j].date);
                                                break;
                                            case 2:
                                                mardiPauseTabDatas.push(precisionRound(data.pauseStats[j].temps,2));
                                                mardiPauseTabLabels.push(data.pauseStats[j].date);
                                                break;
                                            case 3:
                                                mercrediPauseTabDatas.push(precisionRound(data.pauseStats[j].temps,2));
                                                mercrediPauseTabLabels.push(data.pauseStats[j].date);
                                                break;
                                            case 4:
                                                jeudiPauseTabDatas.push(precisionRound(data.pauseStats[j].temps,2));
                                                jeudiPauseTabLabels.push(data.pauseStats[j].date);
                                                break;
                                            case 5:
                                                vendrediPauseTabDatas.push(precisionRound(data.pauseStats[j].temps,2));
                                                vendrediPauseTabLabels.push(data.pauseStats[j].date);
                                                break;
                                            case 6:
                                                samediPauseTabDatas.push(precisionRound(data.pauseStats[j].temps,2));
                                                samediPauseTabLabels.push(data.pauseStats[j].date);
                                                break;
                                            case 0:
                                                dimanchePauseTabDatas.push(precisionRound(data.pauseStats[j].temps,2));
                                                dimanchePauseTabLabels.push(data.pauseStats[j].date);
                                                break;
                                        }

                                        pauseDatas.push(data.pauseStats[j].temps);
                                        pauseLabels.push(data.pauseStats[j].date);
                                        $("#tabDepartsPrematures12").append(
                                            "<tr>"+
                                                "<td>"+data.pauseStats[j].date+"</td>"+
                                                "<td>"+data.pauseStats[j].heureDepart+"</td>"+
                                                "<td>"+(Math.trunc(data.pauseStats[j].temps_min)+1)+" Min</td>"+
                                            "</tr>"
                                        );
                                    }
                                }

                                // Before any action else we must delete the content
                                $("#tabDepartsPrematures17").html("");
                                if(data.finStats.length > 0){
                                    for(var k=0;k < data.finStats.length;k++){

                                        var laDate = data.finStats[k].date;
                                        var tabDate = laDate.split("/");
                                        var dateReformate = tabDate[2]+"/"+tabDate[1]+"/"+tabDate[0];
                                        var dateObject = new Date(dateReformate);
                                        var leJour = dateObject.getDay();
                                        switch (leJour){
                                            case 1:
                                                lundiFinTabDatas.push(precisionRound(data.finStats[k].temps,0));
                                                lundiFinTabLabels.push(data.finStats[k].date);
                                                break;
                                            case 2:
                                                mardiFinTabDatas.push(precisionRound(data.finStats[k].temps,0));
                                                mardiFinTabLabels.push(data.finStats[k].date);
                                                break;
                                            case 3:
                                                mercrediFinTabDatas.push(precisionRound(data.finStats[k].temps,0));
                                                mercrediFinTabLabels.push(data.finStats[k].date);
                                                break;
                                            case 4:
                                                jeudiFinTabDatas.push(precisionRound(data.finStats[k].temps,0));
                                                jeudiFinTabLabels.push(data.finStats[k].date);
                                                break;
                                            case 5:
                                                vendrediFinTabDatas.push(precisionRound(data.finStats[k].temps,0));
                                                vendrediFinTabLabels.push(data.finStats[k].date);
                                                break;
                                            case 6:
                                                samediFinTabDatas.push(precisionRound(data.finStats[k].temps,0));
                                                samediFinTabLabels.push(data.finStats[k].date);
                                                break;
                                            case 0:
                                                dimancheFinTabDatas.push(precisionRound(data.finStats[k].temps,0));
                                                dimancheFinTabLabels.push(data.finStats[k].date);
                                                break;
                                        }

                                        finDatas.push(data.finStats[k].temps);
                                        finLabels.push(data.finStats[k].date);
                                        $("#tabDepartsPrematures17").append(
                                            "<tr>"+
                                            "<td>"+data.finStats[k].date+"</td>"+
                                            "<td>"+data.finStats[k].heureDepart+"</td>"+
                                            "<td>"+(Math.trunc(data.finStats[k].temps_min)+1)+" Min</td>"+
                                            "</tr>"
                                        );
                                    }
                                }

                                // Before any action else we must delete the content
                                $("#tabRetards8").html("");
                                if(data.retardPauseStats.length > 0){
                                    for(var l=0;l < data.retardPauseStats.length;l++){

                                        var laDate = data.retardPauseStats[l].date;
                                        var tabDate = laDate.split("/");
                                        var dateReformate = tabDate[2]+"/"+tabDate[1]+"/"+tabDate[0];
                                        var dateObject = new Date(dateReformate);
                                        var leJour = dateObject.getDay();
                                        switch (leJour){
                                            case 1:
                                                lundiRetardPauseTabDatas.push(precisionRound(data.retardPauseStats[l].temps,0));
                                                lundiRetardPauseTabLabels.push(data.retardPauseStats[l].date);
                                                break;
                                            case 2:
                                                mardiRetardPauseTabDatas.push(precisionRound(data.retardPauseStats[l].temps,0));
                                                mardiRetardPauseTabLabels.push(data.retardPauseStats[l].date);
                                                break;
                                            case 3:
                                                mercrediRetardPauseTabDatas.push(precisionRound(data.retardPauseStats[l].temps,0));
                                                mercrediRetardPauseTabLabels.push(data.retardPauseStats[l].date);
                                                break;
                                            case 4:
                                                jeudiRetardPauseTabDatas.push(precisionRound(data.retardPauseStats[l].temps,0));
                                                jeudiRetardPauseTabLabels.push(data.retardPauseStats[l].date);
                                                break;
                                            case 5:
                                                vendrediRetardPauseTabDatas.push(precisionRound(data.retardPauseStats[l].temps,0));
                                                vendrediRetardPauseTabLabels.push(data.retardPauseStats[l].date);
                                                break;
                                            case 6:
                                                samediRetardPauseTabDatas.push(precisionRound(data.retardPauseStats[l].temps,0));
                                                samediRetardPauseTabLabels.push(data.retardPauseStats[l].date);
                                                break;
                                            case 0:
                                                dimancheRetardPauseTabDatas.push(precisionRound(data.retardPauseStats[l].temps,0));
                                                dimancheRetardPauseTabLabels.push(data.retardPauseStats[l].date);
                                                break;
                                        }

                                        retardPauseDatas.push(data.retardPauseStats[l].temps);
                                        retardPauseLabels.push(data.retardPauseStats[l].date);
                                        $("#tabRetards8").append(
                                            "<tr>"+
                                            "<td>"+data.retardPauseStats[l].date+"</td>"+
                                            "<td>"+data.retardPauseStats[l].heureRetard+"</td>"+
                                            "<td>"+Math.trunc(data.retardPauseStats[l].temps_min)+" Min</td>"+
                                            "</tr>"
                                        );
                                    }
                                }

                                // Before any action else we must delete the content
                                $("#tabRetards14").html("");
                                if(data.retardStats.length > 0){
                                    for(var m=0;m < data.retardStats.length;m++){

                                        var laDate = data.retardStats[m].date;
                                        var tabDate = laDate.split("/");
                                        var dateReformate = tabDate[2]+"/"+tabDate[1]+"/"+tabDate[0];
                                        var dateObject = new Date(dateReformate);
                                        var leJour = dateObject.getDay();
                                        switch (leJour){
                                            case 1:
                                                lundiRetardTabDatas.push(precisionRound(data.retardStats[m].temps,0));
                                                lundiRetardTabLabels.push(data.retardStats[m].date);
                                                break;
                                            case 2:
                                                mardiRetardTabDatas.push(precisionRound(data.retardStats[m].temps,0));
                                                mardiRetardTabLabels.push(data.retardStats[m].date);
                                                break;
                                            case 3:
                                                mercrediRetardTabDatas.push(precisionRound(data.retardStats[m].temps,0));
                                                mercrediRetardTabLabels.push(data.retardStats[m].date);
                                                break;
                                            case 4:
                                                jeudiRetardTabDatas.push(precisionRound(data.retardStats[m].temps,0));
                                                jeudiRetardTabLabels.push(data.retardStats[m].date);
                                                break;
                                            case 5:
                                                vendrediRetardTabDatas.push(precisionRound(data.retardStats[m].temps,0));
                                                vendrediRetardTabLabels.push(data.retardStats[m].date);
                                                break;
                                            case 6:
                                                samediRetardTabDatas.push(precisionRound(data.retardStats[m].temps,0));
                                                samediRetardTabLabels.push(data.retardStats[m].date);
                                                break;
                                            case 0:
                                                dimancheRetardTabDatas.push(precisionRound(data.retardStats[m].temps,0));
                                                dimancheRetardTabLabels.push(data.retardStats[m].date);
                                                break;
                                        }

                                        retardDatas.push(data.retardStats[m].temps);
                                        retardLabels.push(data.retardStats[m].date);
                                        $("#tabRetards14").append(
                                            "<tr>"+
                                            "<td>"+data.retardStats[m].date+"</td>"+
                                            "<td>"+data.retardStats[m].heureRetard+"</td>"+
                                            "<td>"+Math.trunc(data.retardStats[m].temps_min)+" Min</td>"+
                                            "</tr>"
                                        );
                                    }
                                }

                                // Script pour remplir le tableau de stats des permissions

                                $("#tabPermissions").html("");
                                $.each(data.permissionData,function (id) {
                                    $.each(data.permissionData[id],function (el) {
                                        var losedTime = data.permissionData[id][el].tempsPerdu;
                                        if (losedTime >= 60){
                                            losedTime = precisionRound((losedTime/60),2)+" H ";
                                        }else{
                                            losedTime = precisionRound(losedTime,2)+" H";
                                        }
                                        $("#tabPermissions").append("" +
                                            "<tr>" +
                                                "<td>"+data.permissionData[id][el].date+"</td>" +
                                                "<td>"+data.permissionData[id][el].type+"</td>" +
                                                "<td>"+losedTime+"</td>"+
                                                "<td>"+precisionRound((data.permissionData[id][el].tempsPerdu*salaryPerMin),0)+"</td>" +
                                            "</tr>");
                                    });
                                });

                                // Les diagrammes
                                // Diagramme circulaire des absences

                                $("#myPieChart").remove();
                                var element = "<canvas id='myPieChart' class='card' style='cursor: pointer'></canvas>";
                                $(".myPieChartContainer").append(element);
                                var ctx = document.getElementById('myPieChart').getContext('2d');
                                var myPieChart = new Chart(ctx,{
                                    type: 'pie',
                                    data: {
                                        datasets: [{
                                            label: "Absences",
                                            backgroundColor: ['#ff6384', '#36a2eb'],
                                            data: [data.tpr,data.tpd],
                                        }],
                                        labels : [
                                            'Cumul des retards (en heure)',
                                            'Cumul des départs avant l\'heure (en heure)'
                                        ]
                                    },
                                    options: {
                                        onClick:function () {
                                            // On repositionne le scrollbar
                                            var elem = document.getElementById("chartsContainer");
                                            elem.scrollIntoView(true);
                                        }
                                    },
                                });

                                // Diagramme circulaire des quotas
                                var ctx = document.getElementById('quotaPieChart').getContext('2d');
                                var myPieChart = new Chart(ctx,{
                                    type: 'pie',
                                    data: {
                                        datasets: [{
                                            label: "Absences",
                                            backgroundColor: ['#ff6384', '#36a2eb'],
                                            data: [data.quota_total,data.quota_fait],
                                        }],
                                        labels : [
                                            'Quota normal devant etre fait',
                                            'Quota fait par l\'employé'
                                        ]
                                    },
                                    options: {
                                        onClick:function () {
                                            // On repositionne le scrollbar
                                            var elem = document.getElementById("chartsContainer");
                                            elem.scrollIntoView(true);
                                        }
                                    },
                                });

                                // Diagramme à bandes des absences
                                $("#myChart").remove();
                                $(".data_placeholder").remove();
                                var element = "<canvas id='myChart' class='card' style='cursor: pointer'></canvas>";
                                $(".myChartContainer").append(element);
                                var ctx = document.getElementById('myChart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'bar',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Absences",
                                            backgroundColor: 'orange',
                                            borderColor: 'orange',
                                            data: [data.nbreAbsences],
                                        }],
                                        labels : ["Absences"]
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des absences"
                                        },
                                        scales: {
                                            xAxes: [{
                                                barPercentage: 0.2
                                            }]
                                        }
                                    }
                                });

                                /*
                                * Diagramme linéaire On a 7 jours de la semaine
                                *
                                * Ce qui fait un total de 7*4 = 28 Diagramme
                                */

                                // Pour lundi
                                $("#lundi-m-chart").remove();
                                var element = "<canvas id='lundi-m-chart'></canvas>";
                                $(".lundiDiagDep12").append(element);
                                var ctx = document.getElementById('lundi-m-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: lundiPauseTabDatas,
                                        }],
                                        labels : lundiPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 12H00"
                                        }
                                    }
                                });

                                $("#lundi-n-chart").remove();
                                var element = "<canvas id='lundi-n-chart'></canvas>";
                                $(".lundiDiagDep18").append(element);
                                var ctx = document.getElementById('lundi-n-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: lundiFinTabDatas,
                                        }],
                                        labels: lundiFinTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 18H00"
                                        }
                                    }
                                });

                                $("#lundi-m8-chart").remove();
                                var element = "<canvas id='lundi-m8-chart'></canvas>";
                                $(".lundiDiagRet8").append(element);
                                var ctx = document.getElementById('lundi-m8-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: lundiRetardTabDatas,
                                        }],
                                        labels : lundiRetardTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 8H00"
                                        }
                                    }
                                });

                                $("#lundi-n14-chart").remove();
                                var element = "<canvas id='lundi-n14-chart'></canvas>";
                                $(".lundiDiagRet14").append(element);
                                var ctx = document.getElementById('lundi-n14-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: lundiRetardPauseTabDatas,
                                        }],
                                        labels: lundiRetardPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 14H00"
                                        }
                                    }
                                });

                                /* --------------------------------|
                                * Pour Mardi                       |
                                *  --------------------------------|
                                */
                                $("#mardi-m-chart").remove();
                                var element = "<canvas id='mardi-m-chart'></canvas>";
                                $(".mardiDiagDep12").append(element);
                                var ctx = document.getElementById('mardi-m-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: mardiPauseTabDatas,
                                        }],
                                        labels : mardiPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 12H00"
                                        }
                                    }
                                });

                                $("#mardi-n-chart").remove();
                                var element = "<canvas id='mardi-n-chart'></canvas>";
                                $(".mardiDiagDep18").append(element);
                                var ctx = document.getElementById('mardi-n-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: mardiFinTabDatas,
                                        }],
                                        labels: mardiFinTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 18H00"
                                        }
                                    }
                                });

                                $("#mardi-m8-chart").remove();
                                var element = "<canvas id='mardi-m8-chart'></canvas>";
                                $(".mardiDiagRet8").append(element);
                                var ctx = document.getElementById('mardi-m8-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: mardiRetardTabDatas,
                                        }],
                                        labels : mardiRetardTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 8H00"
                                        }
                                    }
                                });

                                $("#mardi-n14-chart").remove();
                                var element = "<canvas id='mardi-n14-chart'></canvas>";
                                $(".mardiDiagRet14").append(element);
                                var ctx = document.getElementById('mardi-n14-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: mardiRetardPauseTabDatas,
                                        }],
                                        labels: mardiRetardPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 14H00"
                                        }
                                    }
                                });

                                /* --------------------------------|
                                * Pour Mercredi                    |
                                *  --------------------------------|
                                */
                                $("#mercredi-m-chart").remove();
                                var element = "<canvas id='mercredi-m-chart'></canvas>";
                                $(".mercrediDiagDep12").append(element);
                                var ctx = document.getElementById('mercredi-m-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: mercrediPauseTabDatas,
                                        }],
                                        labels : mercrediPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 12H00"
                                        }
                                    }
                                });

                                $("#mercredi-n-chart").remove();
                                var element = "<canvas id='mercredi-n-chart'></canvas>";
                                $(".mercrediDiagDep18").append(element);
                                var ctx = document.getElementById('mercredi-n-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: mercrediFinTabDatas,
                                        }],
                                        labels: mercrediFinTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 18H00"
                                        }
                                    }
                                });

                                $("#mercredi-m8-chart").remove();
                                var element = "<canvas id='mercredi-m8-chart'></canvas>";
                                $(".mercrediDiagRet8").append(element);
                                var ctx = document.getElementById('mercredi-m8-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: mercrediRetardTabDatas,
                                        }],
                                        labels : mercrediRetardTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 8H00"
                                        }
                                    }
                                });

                                $("#mercredi-n14-chart").remove();
                                var element = "<canvas id='mercredi-n14-chart'></canvas>";
                                $(".mercrediDiagRet14").append(element);
                                var ctx = document.getElementById('mercredi-n14-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: mercrediRetardPauseTabDatas,
                                        }],
                                        labels: mercrediRetardPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 14H00"
                                        }
                                    }
                                });

                                /* --------------------------------|
                                * Pour Jeudi                       |
                                *  --------------------------------|
                                */
                                $("#jeudi-m-chart").remove();
                                var element = "<canvas id='jeudi-m-chart'></canvas>";
                                $(".jeudiDiagDep12").append(element);
                                var ctx = document.getElementById('jeudi-m-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: jeudiPauseTabDatas,
                                        }],
                                        labels : jeudiPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 12H00"
                                        }
                                    }
                                });

                                $("#jeudi-n-chart").remove();
                                var element = "<canvas id='jeudi-n-chart'></canvas>";
                                $(".jeudiDiagDep18").append(element);
                                var ctx = document.getElementById('jeudi-n-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: jeudiFinTabDatas,
                                        }],
                                        labels: jeudiFinTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 18H00"
                                        }
                                    }
                                });

                                $("#jeudi-m8-chart").remove();
                                var element = "<canvas id='jeudi-m8-chart'></canvas>";
                                $(".jeudiDiagRet8").append(element);
                                var ctx = document.getElementById('jeudi-m8-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: jeudiRetardTabDatas,
                                        }],
                                        labels : jeudiRetardTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 8H00"
                                        }
                                    }
                                });

                                $("#jeudi-n14-chart").remove();
                                var element = "<canvas id='jeudi-n14-chart'></canvas>";
                                $(".jeudiDiagRet14").append(element);
                                var ctx = document.getElementById('jeudi-n14-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: jeudiRetardPauseTabDatas,
                                        }],
                                        labels: jeudiRetardPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 14H00"
                                        }
                                    }
                                });

                                /* --------------------------------|
                                * Pour Vendredi                    |
                                *  --------------------------------|
                                */
                                $("#vendredi-m-chart").remove();
                                var element = "<canvas id='vendredi-m-chart'></canvas>";
                                $(".vendrediDiagDep12").append(element);
                                var ctx = document.getElementById('vendredi-m-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: vendrediPauseTabDatas,
                                        }],
                                        labels : vendrediPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 12H00"
                                        }
                                    }
                                });

                                $("#vendredi-n-chart").remove();
                                var element = "<canvas id='vendredi-n-chart'></canvas>";
                                $(".vendrediDiagDep18").append(element);
                                var ctx = document.getElementById('vendredi-n-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: vendrediFinTabDatas,
                                        }],
                                        labels: vendrediFinTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 18H00"
                                        }
                                    }
                                });

                                $("#vendredi-m8-chart").remove();
                                var element = "<canvas id='vendredi-m8-chart'></canvas>";
                                $(".vendrediDiagRet8").append(element);
                                var ctx = document.getElementById('vendredi-m8-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: vendrediRetardTabDatas,
                                        }],
                                        labels : vendrediRetardTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 8H00"
                                        }
                                    }
                                });

                                $("#vendredi-n14-chart").remove();
                                var element = "<canvas id='vendredi-n14-chart'></canvas>";
                                $(".vendrediDiagRet14").append(element);
                                var ctx = document.getElementById('vendredi-n14-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: vendrediRetardPauseTabDatas,
                                        }],
                                        labels: vendrediRetardPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 14H00"
                                        }
                                    }
                                });

                                /* --------------------------------|
                                * Pour Samedi                      |
                                *  --------------------------------|
                                */
                                $("#samedi-m-chart").remove();
                                var element = "<canvas id='samedi-m-chart'></canvas>";
                                $(".samediDiagDep12").append(element);
                                var ctx = document.getElementById('samedi-m-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: samediPauseTabDatas,
                                        }],
                                        labels : samediPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 12H00"
                                        }
                                    }
                                });

                                $("#samedi-n-chart").remove();
                                var element = "<canvas id='samedi-n-chart'></canvas>";
                                $(".samediDiagDep18").append(element);
                                var ctx = document.getElementById('samedi-n-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: samediFinTabDatas,
                                        }],
                                        labels: samediFinTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 18H00"
                                        }
                                    }
                                });

                                $("#samedi-m8-chart").remove();
                                var element = "<canvas id='samedi-m8-chart'></canvas>";
                                $(".samediDiagRet8").append(element);
                                var ctx = document.getElementById('samedi-m8-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: samediRetardTabDatas,
                                        }],
                                        labels : samediRetardTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 8H00"
                                        }
                                    }
                                });

                                $("#samedi-n14-chart").remove();
                                var element = "<canvas id='samedi-n14-chart'></canvas>";
                                $(".samediDiagRet14").append(element);
                                var ctx = document.getElementById('samedi-n14-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: samediRetardPauseTabDatas,
                                        }],
                                        labels: samediRetardPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 14H00"
                                        }
                                    }
                                });

                                /* --------------------------------|
                                * Pour Dimanche                    |
                                *  --------------------------------|
                                */
                                $("#dimanche-m-chart").remove();
                                var element = "<canvas id='dimanche-m-chart'></canvas>";
                                $(".dimancheDiagDep12").append(element);
                                var ctx = document.getElementById('dimanche-m-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: dimanchePauseTabDatas,
                                        }],
                                        labels : dimanchePauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 12H00"
                                        }
                                    }
                                });

                                $("#dimanche-n-chart").remove();
                                var element = "<canvas id='dimanche-n-chart'></canvas>";
                                $(".dimancheDiagDep18").append(element);
                                var ctx = document.getElementById('dimanche-n-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: dimancheFinTabDatas,
                                        }],
                                        labels: dimancheFinTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des départs prématurés de 18H00"
                                        }
                                    }
                                });

                                $("#dimanche-m8-chart").remove();
                                var element = "<canvas id='dimanche-m8-chart'></canvas>";
                                $(".dimancheDiagRet8").append(element);
                                var ctx = document.getElementById('dimanche-m8-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#36a2eb',
                                            data: dimancheRetardTabDatas,
                                        }],
                                        labels : dimancheRetardTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 8H00"
                                        }
                                    }
                                });

                                $("#dimanche-n14-chart").remove();
                                var element = "<canvas id='dimanche-n14-chart'></canvas>";
                                $(".dimancheDiagRet14").append(element);
                                var ctx = document.getElementById('dimanche-n14-chart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    // The type of chart we want to create
                                    type: 'line',

                                    // The data for our dataset
                                    data: {
                                        labels: [0, 20, 40, 60, 80,100,120],
                                        datasets: [{
                                            label: "Heure",
                                            borderColor: '#ff6384',
                                            data: dimancheRetardPauseTabDatas,
                                        }],
                                        labels: dimancheRetardPauseTabLabels
                                    },

                                    // Configuration options go here
                                    options: {
                                        title:{
                                            display:true,
                                            text: "Diagramme des retards de 14H00"
                                        }
                                    }
                                });



                                /*
                                * Now we remove all no needed diagrams
                                * for all days
                                */
                                if (data.tabType["lundi"] != null && data.tabType["lundi"] != "1"){
                                    $(".lundiDiagDep12").hide();
                                    $(".lundiDiagRet14").hide();
                                }if(data.tabType["mardi"] != null && data.tabType["mardi"] != "1"){
                                    $(".mardiDiagDep12").hide();
                                    $(".mardiDiagRet14").hide();

                                }if(data.tabType["mercredi"] != null && data.tabType["mercredi"] != "1"){
                                    $(".mercrediDiagDep12").hide();
                                    $(".mercrediDiagRet14").hide();
                                }if(data.tabType["jeudi"] != null && data.tabType["jeudi"] != "1"){
                                    $(".jeudiDiagDep12").hide();
                                    $(".jeudiDiagRet14").hide();
                                }if(data.tabType["vendredi"] != null && data.tabType["vendredi"] != "1"){
                                    $(".vendrediDiagDep12").hide();
                                    $(".vendrediDiagRet14").hide();
                                }if(data.tabType["samedi"] != null && data.tabType["samedi"] != "1"){
                                    $(".samediDiagDep12").hide();
                                    $(".samediDiagRet14").hide();
                                }if(data.tabType["dimanche"] != null && data.tabType["dimanche"] != "1"){
                                    $(".dimancheDiagDep12").hide();
                                    $(".dimancheDiagRet14").hide();
                                }

                                /*
                                * Now we remove diagrams if we don't need weekends
                                */
                                if(data.tabType["samedi"] == null){
                                    $(".samediDiagDep12").hide();
                                    $(".samediDiagDep18").hide();
                                    $(".samediDiagRet14").hide();
                                    $(".samediDiagRet8").hide();
                                }if(data.tabType["dimanche"] == null){
                                    $(".dimancheDiagDep12").hide();
                                    $(".dimancheDiagDep18").hide();
                                    $(".dimancheDiagRet14").hide();
                                    $(".dimancheDiagRet8").hide();
                                }

                                /*
                                * Now the last verification is if the datas are null
                                */

                                // For monday
                                if(lundiPauseTabDatas.length == 0){
                                    $(".lundiDiagDep12").hide();
                                }else{
                                    $(".lundiDiagDep12").show();
                                }
                                if(lundiRetardTabDatas.length == 0){
                                    $(".lundiDiagRet8").hide();
                                }else{
                                    $(".lundiDiagRet8").show();
                                }
                                if(lundiRetardPauseTabDatas.length == 0){
                                    $(".lundiDiagRet14").hide();
                                }else{
                                    $(".lundiDiagRet14").show();
                                }
                                if(lundiFinTabDatas.length == 0){
                                    $(".lundiDiagDep18").hide();
                                }else{
                                    $(".lundiDiagDep18").show();
                                }

                                // For tuesday
                                if(mardiPauseTabDatas.length == 0){
                                    $(".mardiDiagDep12").hide();
                                }else{
                                    $(".mardiDiagDep12").show();
                                }
                                if(mardiRetardTabDatas.length == 0){
                                    $(".mardiDiagRet8").hide();
                                }else{
                                    $(".mardiDiagRet8").show();
                                }
                                if(mardiRetardPauseTabDatas.length == 0){
                                    $(".mardiDiagRet14").hide();
                                }else{
                                    $(".mardiDiagRet14").show();
                                }
                                if(mardiFinTabDatas.length == 0){
                                    $(".mardiDiagDep18").hide();
                                }else{
                                    $(".mardiDiagDep18").show();
                                }

                                // For wednesday
                                if(mercrediPauseTabDatas.length == 0){
                                    $(".mercrediDiagDep12").hide();
                                }else{
                                    $(".mercrediDiagDep12").show();
                                }
                                if(mercrediRetardTabDatas.length == 0){
                                    $(".mercrediDiagRet8").hide();
                                }else{
                                    $(".mercrediDiagRet8").show();
                                }
                                if(mercrediRetardPauseTabDatas.length == 0){
                                    $(".mercrediDiagRet14").hide();
                                }else{
                                    $(".mercrediDiagRet14").show();
                                }
                                if(mercrediFinTabDatas.length == 0){
                                    $(".mercrediDiagDep18").hide();
                                }else{
                                    $(".mercrediDiagDep18").show();
                                }

                                // For thursday
                                if(jeudiPauseTabDatas.length == 0){
                                    $(".jeudiDiagDep12").hide();
                                }else{
                                    $(".jeudiDiagDep12").show();
                                }
                                if(jeudiRetardTabDatas.length == 0){
                                    $(".jeudiDiagRet8").hide();
                                }else{
                                    $(".jeudiDiagRet8").show();
                                }
                                if(jeudiRetardPauseTabDatas.length == 0){
                                    $(".jeudiDiagRet14").hide();
                                }else{
                                    $(".jeudiDiagRet14").show();
                                }
                                if(jeudiFinTabDatas.length == 0){
                                    $(".jeudiDiagDep18").hide();
                                }else{
                                    $(".jeudiDiagDep18").show();
                                }

                                // For friday
                                if(vendrediPauseTabDatas.length == 0){
                                    $(".vendrediDiagDep12").hide();
                                }else{
                                    $(".vendrediDiagDep12").show();
                                }
                                if(vendrediRetardTabDatas.length == 0){
                                    $(".vendrediDiagRet8").hide();
                                }else{
                                    $(".vendrediDiagRet8").show();
                                }
                                if(vendrediRetardPauseTabDatas.length == 0){
                                    $(".vendrediDiagRet14").hide();
                                }else{
                                    $(".vendrediDiagRet14").show();
                                }
                                if(vendrediFinTabDatas.length == 0){
                                    $(".vendrediDiagDep18").hide();
                                }else{
                                    $(".vendrediDiagDep18").show();
                                }

                                // For saturday
                                if(samediPauseTabDatas.length == 0){
                                    $(".samediDiagDep12").hide();
                                }else{
                                    $(".samediDiagDep12").show();
                                }
                                if(samediRetardTabDatas.length == 0){
                                    $(".samediDiagRet8").hide();
                                }else{
                                    $(".samediDiagRet8").show();
                                }
                                if(samediRetardPauseTabDatas.length == 0){
                                    $(".samediDiagRet14").hide();
                                }else{
                                    $(".samediDiagRet14").show();
                                }
                                if(samediFinTabDatas.length == 0){
                                    $(".samediDiagDep18").hide();
                                }else{
                                    $(".samediDiagDep18").show();
                                }

                                // For Sunday
                                if(dimanchePauseTabDatas.length == 0){
                                    $(".dimancheDiagDep12").hide();
                                }else{
                                    $(".dimancheDiagDep12").show();
                                }
                                if(dimancheRetardTabDatas.length == 0){
                                    $(".dimancheDiagRet8").hide();
                                }else{
                                    $(".dimancheDiagRet8").show();
                                }
                                if(dimancheRetardPauseTabDatas.length == 0){
                                    $(".dimancheDiagRet14").hide();
                                }else{
                                    $(".dimancheDiagRet14").show();
                                }
                                if(dimancheFinTabDatas.length == 0){
                                    $(".dimancheDiagDep18").hide();
                                }else{
                                    $(".dimancheDiagDep18").show();
                                }

                                // For Quota diagram
                                if(data.quota_total == 0){
                                    $(".quotaPieDiagram").hide();
                                }else{
                                    $(".quotaPieDiagram").show();
                                }

                                // For delays piechart
                                if(data.tpr == 0 && data.tpd == 0){
                                    $(".delaysPieChart").hide();
                                }else{
                                    $(".delaysPieChart").show();
                                }

                                // For departures chart
                                if(data.nbreAbsences == 0){
                                    $(".data_placeholder").remove();
                                    $(".myChartContainer").append("<h5 style='padding:20px' class='data_placeholder'>Aucune absence enregistrée</h5>");
                                    $("#myChart").hide();
                                }else{
                                    $("#myChart").show();
                                }

                                // Closing the loading box

                                $('#modal_loading').modal('close');
                            },
                            error: function (msg) {
                                // Closing the loading box
                                $('#modal_loading').modal('close');
                                alert("Erreur : "+msg);
                            }
                        });
                    },
                    error: function(msg) {
                        alert("Erreur : "+msg);
                    }
                });
            }


            var len = {{ listEmployee | length }};
            var tab = [];
            {% for el in listEmployee %}
                tab.push({depId:"{{ el.departement.id }}",id:"{{ el.id }}",ccid:"{{ el.employeeCcid }}",surname:"{{ el.surname }}", lastName:"{{ el.lastName }}"});
            {% endfor %}
            $("#depSelect").change(function(){
                /* On vide le contenu de la table */
                $("#empSelect").html("");
                /* On récupère le département sélectionné */
                var selectedDep = $("#depSelect").val();
                for(var i=0;i<len;i++){
                    //alert("L'id dep est "+res.employees[i].departement.id);
                    /* On vérifie si oui ou nom cet employé appartient au département
                     * Si oui on l'affiche
                     * Sinon on l'ignore tout simplement
                     */
                    var currentEmpDepId = tab[i].depId;
                    if(currentEmpDepId == selectedDep){
                        $("#empSelect").append("" +
                            "<option value="+tab[i].id+">" +tab[i].ccid+" "+tab[i].lastName+" "+tab[i].surname+"</option>"
                        );
                    }
                }
            });

            $("#submitButton").click(function () {


                var dateFrom = new Date($("#fromDate").val()).getTime();
                var dateTo = new Date($("#toDate").val()).getTime();
                if($("#depSelect").val()!=""){
                    if($("#empSelect").val()!=""){
                        if($("#fromDate").val()!=""){
                            if($("#toDate").val()!=""){
                                //if(dateFrom < dateTo || dateFrom == dateTo){
                                    $('#modal_loading').modal('show');
                                    $("#errorContainer").hide();
                                    loadSelectedEmpData($("#empSelect").val());
                                /*}else {
                                    $("#errorContainer").show();
                                    $("#errorContainer div span").text("Erreur : La date de début ne peut pas etre superieur à la date de fin");
                                    $("#containerMustBeHidden").attr("style","display:none");
                                }*/
                            }else {
                                $("#errorContainer").show();
                                $("#errorContainer div span").text("Erreur : veuillez choisir une date de fin valide");
                                $("#containerMustBeHidden").attr("style","display:none");
                            }
                        }else{
                            $("#errorContainer").show();
                            $("#errorContainer div span").text("Erreur : veuillez choisir une date de début valide");
                            $("#containerMustBeHidden").attr("style","display:none");
                        }
                    }else{
                        $("#errorContainer").show();
                        $("#errorContainer div span").text("Erreur : veuillez choisir un employé");
                        $("#containerMustBeHidden").attr("style","display:none");
                    }
                }else{
                    $("#errorContainer").show();
                    $("#errorContainer div span").text("Erreur : veuillez choisir un département");
                    $("#containerMustBeHidden").attr("style","display:none");
                }
            });
        });
    </script>
    <script>
        // On s'attaque aux collapsibles
        $(function () {
            $(".cl_PersStats").addClass("collapsible_element_active");
            $(".navigation_collapsible").collapsible('open',2);


            $('.datepicker').on('mousedown',function(event){
                event.preventDefault();
            });

        });
    </script>
{% endblock %}
