{% extends 'base.html.twig' %}

{% block body %}

<!-- Modal for ajax loading -->
<div>
    <!-- Modal for ajax loading -->
    <div id="modal_loading" class="modal ajax_modals">
        <div class="modal-content" style="width: 200px;display:table;position:relative;margin: 0 auto; top: calc(50% - 24px);">
            <p class="center">
                <img class="mw-100 mh-100" src="{{ asset('img/ajax_loaders/ajax-loading.gif') }}">
            </p>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="wrapper">

        {% include('cas/partials/_sidebar.html.twig') %}

        <div class="content-page">
            <div class="content">
                
                <div class="row card">
                    <div class="col-lg-12 card-body">
                        <!-- hidden input -->
                        <div style="display: none">
                            <select id="depSelected">
                                {% for dep in departements %}
                                    <option value="{{ dep.id }}">{{ dep.id }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <h5>Changer l'état des machines</h5>

                                <div class="row">
                                    <div class="col-lg-12">
                                        <ul class="collapsible" data-collapsible="accordion">
                                            <li>
                                                <div class="collapsible-header collapsible-header-title active">Changement d'état</div>
                                                <div class="collapsible-body" style="padding-bottom: 0px">
                                                    <div class="row">
                                                        <form class="col-lg-12" id="main_form">
                                                            <p>
                                                                <input name="group1" value="1" type="radio" id="el1" />
                                                                <label for="el1">Toutes les machines</label>
                                                                <input name="group1" value="2" type="radio" id="el2" />
                                                                <label for="el2">Par départements</label>
                                                                <input name="group1" value="3" type="radio" id="el3" />
                                                                <label for="el3">Sélection unique</label>
                                                            </p>
                                                            <span id="type1">
                                            <div class="row firstOne">
                                                <div class="col-lg-12">
                                                    <h5>Toutes les machines</h5>
                                                    <span>Changer l'état de toutes les machines du système</span>
                                                </div>
                                            </div>
                                            <div id="rebootForAll" class="btn btn-primary btn-circle btn-md">
                                                <span class="fa fa-sync fa-2x"></span>
                                            </div>
                                            <span>Redémarrer les machines</span>
                                            <span style="margin-left: 70px">Dernier redémarrage : 13/07/2017 à 18h00</span>
                                        </span>
                                                            <span id="type2">
                                            <div class="row firstOne">
                                                <div class="col-lg-12">
                                                    <h5>Par départements</h5>
                                                    <span>Choisissez le département</span>
                                                    <select multiple="multiple" class="form-control" id="depSelected2">
                                                        {% for dep in departements %}
                                                            <option value="{{ dep.id }}">{{ dep.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                    <br>
                                                    Changer l'état de toutes les machines d'un département donné
                                                </div>
                                            </div>
                                            <div id="rebootForDep" class="btn btn-success btn-circle btn-md">
                                                <span class="fa fa-sync fa-2x"></span>
                                            </div>
                                            <span>Redémarrer les machines</span>
                                            <span style="margin-left: 70px">Dernier redémarrage : 13/07/2017 à 18h00</span>
                                        </span>
                                                            <span id="type3">
                                            <div class="row firstOne">
                                                <div class="col-lg-12">
                                                    <h5>Sélection unique</h5>
                                                    <span>Choisissez la machine correspondante</span>
                                                    <select id="macSelected" class="form-control">
                                                        {% for mac in machines %}
                                                            <option value="{{ mac.machineId }}">{{ mac.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                    <br>
                                                    Changer l'état d'une machine précise
                                                </div>
                                            </div>
                                            <div id="rebootForMac" class="btn btn-primary btn-circle btn-md">
                                                <span class="fa fa-sync fa-2x"></span>
                                            </div>
                                            <span>Redémarrer les machines</span>
                                            <span style="margin-left: 70px">Dernier redémarrage : 13/07/2017 à 18h00</span>
                                        </span>
                                                        </form>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block stylesheets %}
{% endblock %}

{% block javascripts %}
    <script>
        $(function () {
            var selected = 0;

            $("#type1").show();
            $("#type2").hide();
            $("#type3").hide();
            $("input[type=radio][name=group1]").change(function () {
                switch (this.value) {
                    case "1":
                        $("#type1").show();
                        $("#type2").hide();
                        $("#type3").hide();
                        selected = 1;
                        break;
                    case "2":
                        $("#type1").hide();
                        $("#type2").show();
                        $("#type3").hide();
                        selected = 2;
                        break;
                    case "3":
                        $("#type1").hide();
                        $("#type2").hide();
                        $("#type3").show();
                        selected = 3;
                        break;
                }
            });
        });
    </script>
    <!-- Script pour les évenements de mise à jour -->
    <script>
        $(function () {
            var tab = [];
            $.each($("#depSelected").children(),function (arrayID) {
                var el = $(this).attr("value");
                //console.log("Index : "+arrayID+" Value : "+el);
                tab.push(el);
            });
            console.log(tab);
            //var data = {nom:"Ebenezer",age:21};
            //var tab2 = [data,{nom:"Francis",age:21}];
            //console.log(tab2);
            $("#rebootForAll").click(function () {
                $('#modal_loading').modal('show');
                $.ajax({
                    type: 'POST',
                    url: "{{ path('syncReboot') }}",
                    data: {"deps":tab},
                    success: function (data) {
                        console.log(data);
                        // Closing the loading box

                        $('#modal_loading').modal('hide');
                    },
                    error: function (msg) {
                        alert("erreur");
                        console.log(msg);
                    }
                });
            });
        });
    </script>
    <script>
        $(function () {
            var tab = [];
            console.log(tab);
            $("#rebootForDep").click(function () {
                $('#modal_loading').modal('show');
                var el = $("#depSelected2").val();
                tab.push(el);
                console.log(el);
                $.ajax({
                    type: 'POST',
                    url: "{{ path('syncReboot') }}",
                    data: {"deps":el},
                    success: function (data) {
                        console.log(data);
                        // Closing the loading box

                        $('#modal_loading').modal('hide');
                    },
                    error: function (msg) {
                        alert("erreur");
                        console.log(msg);
                    }
                });
            });
        });
    </script>
    <script>
        $(function () {
            $("#rebootForMac").click(function () {
                $('#modal_loading').modal('show');
                var el = $("#macSelected").val();
                console.log("Element : "+el);
                $.ajax({
                    type: 'POST',
                    url: "{{ path('syncRebootByMac') }}",
                    data: {"mac":el},
                    success: function (data) {
                        console.log(data);
                        // Closing the loading box

                        $('#modal_loading').modal('hide');
                    },
                    error: function (msg) {
                        // Closing the loading box
                        $('#modal_loading').modal('hide');
                        alert("erreur");
                        console.log(msg);
                    }
                });
            });
        });
    </script>

{% endblock %}
